<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cup Cafe Menu</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .menu-img {
      width: 64px;
      height: 64px;
      object-fit: contain;
    }
    .order-section {
      margin-top: 20px;
    }
    .qr-code {
      margin-top: 20px;
    }
  </style>
</head>
<body class="container py-4">

  <h2 class="mb-4">Cup Caf√© Menu</h2>

  <div id="menuContainer" class="row g-3"></div>

  <div class="row mt-4">
    <div class="col-md-4">
      <label>Bean Type:</label>
      <select id="beanSelect" class="form-select"></select>
    </div>
    <div class="col-md-4">
      <label>Milk Type:</label>
      <select id="milkSelect" class="form-select"></select>
    </div>
    <div class="col-md-4">
      <label>Size:</label>
      <select id="sizeSelect" class="form-select"></select>
    </div>
  </div>

  <div class="text-end mt-3">
    <button class="btn btn-primary" onclick="addToOrder()">Add to Order</button>
  </div>

  <div class="order-section">
    <h4>Order Summary</h4>
    <ul id="orderList" class="list-group"></ul>
    <div class="qr-code text-center mt-4">
      <canvas id="qrCanvas"></canvas>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/qrious"></script>
  <script src="js/qr-generator.js"></script>
  <script>
    let menuData = [], beans = [], milks = [], sizes = [];
    let orderItems = [];

    async function loadJSON(path) {
      const res = await fetch(path);
      return res.json();
    }

    async function init() {
      menuData = await loadJSON("jsonData/Data_MenuItem_menu.json");
      beans = (await loadJSON("jsonData/Data_MenuOption_bean.json")).beans;
      milks = (await loadJSON("jsonData/Data_MenuOption_milk.json")).milks;
      sizes = (await loadJSON("jsonData/Data_MenuOption_size.json")).sizes;

      populateMenu();
      populateSelect("beanSelect", beans);
      populateSelect("milkSelect", milks);
      populateSelect("sizeSelect", sizes);
    }

    function populateMenu() {
      const container = document.getElementById("menuContainer");
      container.innerHTML = "";

      menuData.forEach(item => {
        const col = document.createElement("div");
        col.className = "col-4 col-md-2 text-center";
        col.innerHTML = `
          <img src="${item.image}" alt="${item.name}" class="menu-img rounded-circle border" />
          <div class="fw-bold mt-1">${item.name}</div>
          <select class="form-select mt-2" id="submenu-${item.id}">
            <option value="">Choose</option>
            ${item.subMenu.map(sm => `<option value="${sm.id}">${sm.name}</option>`).join('')}
          </select>
        `;
        container.appendChild(col);
      });
    }

    function populateSelect(id, options) {
      const select = document.getElementById(id);
      options.forEach(opt => {
        const option = document.createElement("option");
        option.value = opt.id;
        option.textContent = opt.name;
        select.appendChild(option);
      });
    }

    function addToOrder() {
      const submenuId = getSelectedSubMenu();
      const beanId = document.getElementById("beanSelect").value;
      const milkId = document.getElementById("milkSelect").value;
      const sizeId = document.getElementById("sizeSelect").value;

      if (!submenuId || !beanId || !milkId || !sizeId) {
        alert("Please select all options!");
        return;
      }

      const itemNumber = `${submenuId}${beanId}${milkId}${sizeId}`;
      orderItems.push(itemNumber);
      updateOrderList();
      generateQRCode(orderItems);
    }

    function getSelectedSubMenu() {
      for (const item of menuData) {
        const select = document.getElementById(`submenu-${item.id}`);
        if (select && select.value) return select.value;
      }
      return null;
    }

    function updateOrderList() {
      const list = document.getElementById("orderList");
      list.innerHTML = "";
      orderItems.forEach((item, idx) => {
        const li = document.createElement("li");
        li.className = "list-group-item";
        li.textContent = `#${idx + 1}: ${item}`;
        list.appendChild(li);
      });
    }

    window.onload = init;
  </script>
</body>
</html>
